<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <BehaviorTree ID="MainTree">
    <Sequence>
      <Configure ProductIDs="ProductA,ProductB,ProductC" />
      <ReactiveSequence>
        <Fallback>
          <Data_Condition comparison_type="equal" Field="State" expected_value="operational"
            Property="PackMLState" Asset="https://smartproductionlab.aau.dk/aas/planarTable" />
        </Fallback>
        <Parallel failure_count="-1" success_count="1">
          <SubTree ID="AsepticFilling"
            Xbot="https://smartproductionlab.aau.dk/aas/planarTableShuttle1"
            LoadingSystem="https://smartproductionlab.aau.dk/aas/imaLoadingSystem"
            DispensingSystem="https://smartproductionlab.aau.dk/aas/imaDispensingSystem"
            StopperingSystem="https://smartproductionlab.aau.dk/aas/syntegonStopperingSystem"
            QualityControlSystem="https://smartproductionlab.aau.dk/aas/omronCamera"
            UnloadingSystem="https://smartproductionlab.aau.dk/aas/optimaUnloadingSystem"
            ScrapingSystem="" />
          <SubTree ID="AsepticFilling"
            Xbot="https://smartproductionlab.aau.dk/aas/planarTableShuttle2"
            LoadingSystem="https://smartproductionlab.aau.dk/aas/imaLoadingSystem"
            DispensingSystem="https://smartproductionlab.aau.dk/aas/imaDispensingSystem"
            StopperingSystem="https://smartproductionlab.aau.dk/aas/syntegonStopperingSystem"
            QualityControlSystem="https://smartproductionlab.aau.dk/aas/omronCamera"
            UnloadingSystem="https://smartproductionlab.aau.dk/aas/optimaUnloadingSystem"
            ScrapingSystem="" />
          <SubTree ID="AsepticFilling"
            Xbot="https://smartproductionlab.aau.dk/aas/planarTableShuttle3"
            LoadingSystem="https://smartproductionlab.aau.dk/aas/imaLoadingSystem"
            DispensingSystem="https://smartproductionlab.aau.dk/aas/imaDispensingSystem"
            StopperingSystem="https://smartproductionlab.aau.dk/aas/syntegonStopperingSystem"
            QualityControlSystem="https://smartproductionlab.aau.dk/aas/omronCamera"
            UnloadingSystem="https://smartproductionlab.aau.dk/aas/optimaUnloadingSystem"
            ScrapingSystem="" />
        </Parallel>
      </ReactiveSequence>
    </Sequence>
  </BehaviorTree>
  <BehaviorTree ID="AsepticFilling">
    <Occupy Uuid="{Uuid}" Asset="{Xbot}">
      <KeepRunningUntilEmpty if_empty="SUCCESS" Queue="{ProductIDs}">
        <ReactiveSequence>
          <ReactiveFallback>
            <Data_Condition comparison_type="equal" Field="State" expected_value="operational"
              Property="PackMLState" Asset="{Xbot}" />
            <Sleep msec="10000" />
          </ReactiveFallback>
          <Fallback>
            <SequenceWithMemory />
            <SubTree ID="Scraping" />
          </Fallback>
        </ReactiveSequence>
      </KeepRunningUntilEmpty>
    </Occupy>
  </BehaviorTree>
  <BehaviorTree ID="Loading">
    <SequenceWithMemory>
      <PopElement ProductID="{ProductID}" if_empty="SUCCESS" Queue="{ProductIDs}"
        _onSuccess="scrap:= false" _onFailure="scrap:= true" />
      <Occupy Uuid="{ProductID}" Asset="{LoadingSystem}" _skipIf="scrap == true">
        <ReactiveSequence>
          <ReactiveFallback>
            <Data_Condition comparison_type="equal" Field="State" expected_value="operational"
              Property="PackMLState" Asset="{LoadingSystem}" />
            <Sleep msec="10000" />
          </ReactiveFallback>
          <Sequence>
            <moveToPosition Uuid="{ProductID}" TargetPosition="{Station}" Asset="{Xbot}" />
            <Command_Execution Parameters="'{}'" Uuid="{ProductID}" Operation="load"
              Asset="{LoadingSystem}" />
          </Sequence>
        </ReactiveSequence>
      </Occupy>
    </SequenceWithMemory>
  </BehaviorTree>
  <BehaviorTree ID="Dispensing">
    <Occupy Uuid="{ProductID}" Asset="{DispensingSystem}" _skipIf="scrap == true">
      <ReactiveSequence>
        <ReactiveFallback>
          <Data_Condition comparison_type="equal" Field="State" expected_value="operational"
            Property="PackMLState" Asset="{DispensingSystem}" />
          <Sleep msec="10000" />
        </ReactiveFallback>
        <Sequence>
          <moveToPosition Uuid="{ProductID}" TargetPosition="{Station}" Asset="{Xbot}" />
          <Command_Execution Parameters="'{}'" Uuid="{ProductID}" Operation="dispense"
            Asset="{DispensingSystem}" />
        </Sequence>
      </ReactiveSequence>
    </Occupy>
  </BehaviorTree>
  <BehaviorTree ID="Stoppering">
    <Occupy Uuid="{ProductID}" Asset="{StopperingSystem}" _skipIf="scrap == true">
      <ReactiveSequence>
        <ReactiveFallback>
          <Data_Condition comparison_type="equal" Field="State" expected_value="operational"
            Property="PackMLState" Asset="{StopperingSystem}" />
          <Sleep msec="10000" />
        </ReactiveFallback>
        <Sequence>
          <moveToPosition Uuid="{ProductID}" TargetPosition="{Station}" Asset="{Xbot}" />
          <Command_Execution Parameters="'{}'" Uuid="{ProductID}" Operation="stopper"
            Asset="{StopperingSystem}" />
        </Sequence>
      </ReactiveSequence>
    </Occupy>
  </BehaviorTree>
  <BehaviorTree ID="QualityControl">
    <Occupy Uuid="{ProductID}" Asset="{QualityControlSystem}" _skipIf="scrap == true">
      <ReactiveSequence>
        <ReactiveFallback>
          <Data_Condition comparison_type="equal" Field="State" expected_value="operational"
            Property="PackMLState" Asset="{QualityControlSystem}" />
          <Sleep msec="10000" />
        </ReactiveFallback>
        <Sequence>
          <moveToPosition Uuid="{ProductID}" TargetPosition="{Station}" Asset="{Xbot}" />
          <Command_Execution Parameters="'{}'" Uuid="{ProductID}" Operation="capture"
            Asset="{QualityControlSystem}" />
        </Sequence>
      </ReactiveSequence>
    </Occupy>
  </BehaviorTree>
  <BehaviorTree ID="Unloading">
    <Occupy Uuid="{ProductID}" Asset="{UnloadingSystem}" _skipIf="scrap == true">
      <ReactiveSequence>
        <ReactiveFallback>
          <Data_Condition comparison_type="equal" Field="State" expected_value="operational"
            Property="PackMLState" Asset="{UnloadingSystem}" />
          <Sleep msec="10000" />
        </ReactiveFallback>
        <Sequence>
          <moveToPosition Uuid="{ProductID}" TargetPosition="{Station}" Asset="{Xbot}" />
          <Command_Execution Parameters="'{}'" Uuid="{ProductID}" Operation="unload"
            Asset="{UnloadingSystem}" />
        </Sequence>
      </ReactiveSequence>
    </Occupy>
  </BehaviorTree>
  <BehaviorTree ID="Scraping">
    <Occupy Uuid="{ProductID}" Asset="{UnloadSystem}">
      <ReactiveSequence>
        <ReactiveFallback>
          <Data_Condition comparison_type="equal" Field="State" expected_value="operational"
            Property="PackMLState" Asset="{UnloadSystem}" />
          <Sleep msec="10000" />
        </ReactiveFallback>
        <Sequence>
          <moveToPosition Uuid="{ProductID}" TargetPosition="{Station}" Asset="{Xbot}" />
          <Command_Execution Parameters="'{}'" Uuid="{ProductID}" Operation="unload"
            Asset="{UnloadSystem}" _onSuccess="scrap:=false" />
        </Sequence>
      </ReactiveSequence>
    </Occupy>
  </BehaviorTree>
</root>